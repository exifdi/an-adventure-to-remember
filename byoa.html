<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Archive</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #666666;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            line-height: 1.2;
            overflow-x: hidden;
            height: 100vh;
            letter-spacing: -0.5px;
        }
        
        /* Subtle scanlines */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%, 
                rgba(255, 255, 255, 0.01) 50%
            );
            background-size: 100% 1px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .terminal {
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        .terminal-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: 100%;
        }
        
        .terminal-line {
            margin: 2px 0;
            min-height: 16px;
        }
        
        .loading-text {
            color: #888888;
        }
        
        .error-text {
            color: #aa4444;
            animation: pulse 1s infinite;
        }
        
        .title-text {
            color: #999999;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(153, 153, 153, 0.3);
        }
        
        .input-line {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .prompt {
            color: #666666;
            margin-right: 3px;
        }
        
        .input-field {
            background: transparent;
            border: none;
            color: #888888;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            outline: none;
            flex: 1;
            caret-color: #666666;
            letter-spacing: -0.5px;
        }
        
        .cursor {
            display: inline-block;
            background-color: #444444;
            width: 8px;
            height: 16px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .ascii-art {
            color: #777777;
            text-align: left;
            font-size: 11px;
            line-height: 1;
            text-shadow: 0 0 3px rgba(119, 119, 119, 0.2);
        }
        
        .fireworks-art {
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }
        
        .fireworks-effect {
            color: #ffaa00;
            animation: fireworks 0.8s infinite;
        }
        
        @keyframes fireworks {
            0% { opacity: 1; color: #ffaa00; }
            25% { opacity: 0.8; color: #ff6600; }
            50% { opacity: 0.6; color: #ff0066; }
            75% { opacity: 0.8; color: #6600ff; }
            100% { opacity: 1; color: #00aaff; }
        }
        
        .pixel-art {
            font-size: 10px;
            line-height: 0.8;
            color: #aaaaaa;
            font-family: monospace;
        }
        
        .link-green { color: #228B22; }
        .link-yellow { color: #FFD700; }
        .link-skin { color: #FDBCB4; }
        .hair-brown { color: #8B4513; }
        .hair-blonde { color: #DAA520; }
        
        .sword-art {
            color: #C0C0C0;
            text-shadow: 0 0 2px rgba(192, 192, 192, 0.5);
        }
        
        .neon-blue {
            animation: neonFlash 1.5s ease-in-out infinite;
        }
        
        @keyframes neonFlash {
            0%, 100% {
                color: #00BFFF;
                text-shadow: 
                    0 0 5px #00BFFF,
                    0 0 10px #00BFFF,
                    0 0 15px #00BFFF,
                    0 0 20px #00BFFF;
            }
            50% {
                color: #FF00FF;
                text-shadow: 
                    0 0 5px #FF00FF,
                    0 0 10px #FF00FF,
                    0 0 15px #FF00FF,
                    0 0 20px #FF00FF;
            }
        }
        
        .glitch-text {
            animation: glitch 0.5s infinite;
            color: #555555;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            10% { transform: translate(-1px, -1px); }
            20% { transform: translate(1px, 1px); }
            30% { transform: translate(-1px, 1px); }
            40% { transform: translate(1px, -1px); }
            50% { transform: translate(-1px, -1px); }
            60% { transform: translate(1px, 1px); }
            70% { transform: translate(-1px, 1px); }
            80% { transform: translate(1px, -1px); }
            90% { transform: translate(-1px, -1px); }
            100% { transform: translate(0); }
        }
        
        .hidden {
            display: none;
        }
        
        .waitress-image {
            text-align: center;
            margin: 5px 0;
        }
        
        .waitress-image img {
            max-width: 200px;
            max-height: 200px;
            filter: sepia(100%) hue-rotate(180deg) brightness(0.8);
            opacity: 0.8;
        }
        
        .fireworks-canvas {
            text-align: left;
            margin: 5px 0;
            padding-left: 20px;
        }
        
        .fireworks-canvas canvas {
            background: transparent;
            max-width: 100%;
            height: auto;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body>
    <div class="terminal" id="terminal">
        <div class="terminal-content" id="terminalContent">
            <div class="terminal-line">&gt; INITIALIZING MEMORY DRIVE...</div>
        </div>
    </div>
    
    <!-- Audio element for Vivaldi Summer -->
    <audio id="vivaldiAudio" preload="auto">
        <source src="vivaldi-summer.mp3" type="audio/mpeg">
        <source src="vivaldi-summer.ogg" type="audio/ogg">
        <!-- Fallback: You can use a CDN link to a public domain recording -->
        <source src="https://www.soundjay.com/misc/sounds/classical-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        let currentScene = 'password';
        let gameState = {};
        let isTyping = false;
        let inputEnabled = false;
        
        // Game data structure
        const gameScenes = {
            password: {
                lines: [
                    { text: "> LOADING PERSONAL FILES...", delay: 300, class: 'loading-text' },
                    { text: "> SCANNING FOR AUTHORIZATION...", delay: 600, class: 'loading-text' },
                    { text: "", delay: 400 },
                    { text: "ENTER ACCESS CODE:", delay: 200, class: 'title-text' },
                    { text: "[Hint: Your favorite design movement]", delay: 150 },
                    { text: "", delay: 20 }
                ],
                inputPrompt: "INPUT: ",
                expectedInput: "bauhaus",
                errorMessage: "ACCESS DENIED - TRY AGAIN",
                nextScene: 'welcome'
            },
            
            welcome: {
                lines: [
                    { text: "> ACCESS GRANTED", delay: 20, class: 'loading-text' },
                    { text: "> LOADING USER PROFILE...", delay: 40, class: 'loading-text' },
                    { text: "> IDENTITY CONFIRMED", delay: 60, class: 'loading-text' },
                    { text: "", delay: 100 },
                    { text: "WELCOME NICKI, YOU ARE THE MAIN CHARACTER ‚öîÔ∏è", delay: 100, class: 'title-text' },
                    { text: "", delay: 1400 },
                    { text: "Press ENTER to begin...", delay: 100 }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'july17'
            },
            
            july17: {
                lines: [
                    { text: "> LOADING SCENARIO...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 400 },
                    { text: "IT'S JULY 17TH 2025", delay: 600, class: 'title-text' },
                    { text: "YOU NEED TO WORK THE NEXT DAY, BUT YOU'VE MADE PLANS TO MEET WITH D FROM TWITTER", delay: 200 },
                    { text: "YOU ARE NOT FEELING IT 100%, CONSIDERING WHETHER YOU SHOULD CANCEL", delay: 200 },
                    { text: "", delay: 100 },
                    { text: "THE ETERNAL QUESTION PRESENTS ITSELF:", delay: 100 },
                    { text: "", delay: 100 },
                    { text: "A) GO MEET HER AS PLANNED", delay: 100 },
                    { text: "B) CANCEL, STAY IN CAUSE LET'S FACE IT, YOU ARE ALL YOU NEED", delay: 100 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'firstBar', b: 'gameOver' }
            },
            
            gameOver: {
                lines: [
                    { text: "> PROCESSING CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> CALCULATING TIMELINE ALTERATIONS...", delay: 100, class: 'loading-text' },
                    { text: "", delay: 100 },
                    { text: "CONGRATULATIONS!", delay: 100, class: 'error-text' },
                    { text: "YOU JUST MISSED THE TIME OF YOUR LIFE", delay: 100, class: 'error-text' },
                    { text: "", delay: 1200 },
                    { text: "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê", delay: 100 },
                    { text: "‚îÇ   ‡≤†_‡≤† LOSER   ‚îÇ", delay: 100 },
                    { text: "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò", delay: 100 },
                    { text: "", delay: 1900 },
                    { text: "GAME OVER", delay: 2100, class: 'error-text' },
                    { text: "", delay: 2300 },
                    { text: "Type R to restart...", delay: 100 }
                ],
                inputPrompt: "",
                expectedInput: "r",
                nextScene: 'july17'
            },
            
            firstBar: {
                lines: [
                    { text: "> PROCESSING CHOICE A...", delay: 200, class: 'loading-text' },
                    { text: "> EXCELLENT DECISION DETECTED", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "GREAT CHOICE!", delay: 800, class: 'title-text' },
                    { text: "YOU MEET HER AND SHE'S BEAUTIFUL, INTERESTING AND YOU'RE VIBING. ALREADY A COUPLE DRINKS IN, AND YOU START THINKING OF THINGS...", delay: 100 },
                    { text: "", delay: 120 },
                    { text: "BUT UH-OH... THE BAR IS CLOSING", delay: 100 },
                    { text: "", delay: 1600 },
                    { text: "WHAT SHOULD YOU DO NEXT?", delay: 100 },
                    { text: "", delay: 1000 },
                    { text: "A) MOVE TO THE BAR NEXT DOOR FOR ONE LAST BEER", delay: 220 },
                    { text: "B) CALL IT A NIGHT AND HEAD HOME, YOU DO WORK AFTER ALL TOMORROW", delay: 240 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'secondBar', b: 'gameOver' }
            },
            
            secondBar: {
                lines: [
                    { text: "> PROCESSING ADVENTUROUS CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING NEXT SCENARIO...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "WELL, CONVERSATION IS HEATING UP", delay: 200 },
                    { text: "BUT THERE'S NO ONE ELSE LEFT IN THE BAR", delay: 200 },
                    { text: "", delay: 600 },
                    { text: "SEEMS LIKE YOU'RE DELAYING CLOSE TIME FOR THE STAFF", delay: 200 },
                    { text: "TIME FOR ANOTHER BAR CHANGE?", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "A) SURE, I KNOW OF A PLACE, I'M TAKING HER", delay: 100 },
                    { text: "B) IS THE DRINKING GETTING OUT OF HAND? STILL TIME TO BACK OUT", delay: 100 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'ethicalDilemma', b: 'gameOver' }
            },
            
            ethicalDilemma: {
                lines: [
                    { text: "> PROCESSING BOLD CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING ETHICAL DILEMMA...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "AT RESI", delay: 200, class: 'neon-blue' },
                    { text: "MORE BEERS, AND THE TALK IS GETTING SPICY", delay: 200 },
                    { text: "TALKING ABOUT CHEATING AND CHEATERS...", delay: 250 },
                    { text: "", delay: 300 },
                    { text: "WAIT, IS SHE HITTING ON YOU?", delay: 350 },
                    { text: "BUT SHE HAS A GIRLFRIEND...", delay: 400 },
                    { text: "", delay: 450 },
                    { text: "SHE'S GOING TO THE BATHROOM", delay: 100 },
                    { text: "LEAVING YOU TIME TO DECIDE WHAT TO DO NEXT", delay: 550 },
                    { text: "", delay: 600 },
                    { text: "YOU'RE TEMPTED BUT THIS IS A HARD ETHICAL DECISION", delay: 650 },
                    { text: "YOU CAN SEEK GUIDANCE FROM A WISE ADVISOR:", delay: 700 },
                    { text: "A GIRL THAT WORKS THERE. ASK HER?", delay: 750 },
                    { text: "", delay: 800 },
                    { text: "A) YES", delay: 250 },
                    { text: "B) NO", delay: 200 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'advisor', b: 'indecisive' }
            },
            
            advisor: {
                lines: [
                    { text: "> PROCESSING WISDOM SEEKING...", delay: 500, class: 'loading-text' },
                    { text: "> LOADING ADVISOR RESPONSE...", delay: 500, class: 'loading-text' },
                    { text: "", delay: 1500 },
                    { image: "d27e787009a7223.png", delay: 800, class: 'waitress-image' },
                    { text: "", delay: 400 },
                    { text: "SHE SAYS IT'S OK TO MAKE A MOVE IF THINGS ARE PURELY PHYSICAL", delay: 500 },
                    { text: "THAT'S ALL THE VALIDATION YOU NEED", delay: 500 },
                    { text: "", delay: 300 },
                    { text: "TIME FOR A 4TH BAR?", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "Press ENTER to go to BERLIN...", delay: 500, class: 'title-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'berlin'
            },
            
            indecisive: {
                lines: [
                    { text: "> PROCESSING INDECISION...", delay: 200, class: 'loading-text' },
                    { text: "> ERROR: SELF-RELIANCE FAILURE", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "üòµ‚Äçüí´", delay: 800, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "YOU CANNOT BE TRUSTED TO MAKE YOUR OWN DECISIONS", delay: 1000, class: 'error-text' },
                    { text: "", delay: 600 },
                    { text: "GO BACK AND ASK THE GIRL", delay: 800, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "Type A to go back and ask...", delay: 600 }
                ],
                inputPrompt: "",
                expectedInput: "a",
                nextScene: 'advisor'
            },
            
            berlin: {
                lines: [
                    { text: "> LOADING LOCATION: BERLIN...", delay: 200, class: 'loading-text' },
                    { text: "> ATMOSPHERIC TENSION: MAXIMUM", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "THE CONVERSATION IS GETTING HEATED AGAIN", delay: 800 },
                    { text: "YOU TELL HER YOU WANT TO KISS HER", delay: 1000 },
                    { text: "", delay: 1200 },
                    { text: "SHE'S FLUSTERED", delay: 1400 },
                    { text: "SHE HAS BEEN WAITING FOR IT", delay: 1600 },
                    { text: "SHE TELLS YOU SHE WANTS YOU TO KISS HER", delay: 1800 },
                    { text: "", delay: 2000 },
                    { text: "A) GO FOR IT - KISS HER", delay: 2000 },
                    { text: "B) COME BACK TO YOUR SENSES, CRACK A JOKE AND LEAVE", delay: 2000 },
                    { text: "", delay: 2600 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'fireworks', b: 'crash' }
            },
            
            crash: {
                lines: [
                    { text: "> SYSTEM ERROR...", delay: 200, class: 'glitch-text loading-text' },
                    { text: "> LOGIC FAILURE DETECTED...", delay: 400, class: 'glitch-text loading-text' },
                    { text: "", delay: 800 },
                    { text: "ARE YOU DUMB????", delay: 120, class: 'glitch-text error-text' },
                    { text: "", delay: 1600 },
                    { text: "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó", delay: 200, class: 'glitch-text' },
                    { text: "‚ïë XXXXX ERROR XXXXXX ‚ïë", delay: 200, class: 'glitch-text' },
                    { text: "‚ïë  XXX CORRUPTED XXX ‚ïë", delay: 200, class: 'glitch-text' },
                    { text: "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù", delay: 200, class: 'glitch-text' },
                    { text: "", delay: 200 },
                    { text: "Type B to go BACK...", delay: 300, class: 'error-text' }
                ],
                inputPrompt: "",
                expectedInput: "b",
                nextScene: 'berlin'
            },
            
            fireworks: {
                lines: [
                    { text: "> PROCESSING KISSING INITIATIVE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING FIREWORKS PROTOCOL...", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "* * * * FIREWORKS * * * *", delay: 400, class: 'title-text fireworks-effect' },
                    { canvas: true, delay: 1000 },
                    { text: "", delay: 4500 },
                    { text: "       (‚ó° ‚Äø ‚ó°)üíã(‚ó° ‚Äø ‚ó°)", delay: 400, class: 'ascii-art' },
                    { text: "", delay: 300 },
                    { text: "Press ENTER to continue to finale...", delay: 500, class: 'title-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'finale'
            },
            
            finale: {
                lines: [
                    { text: "> PROCESSING EMOTIONAL DATA...", delay: 500, class: 'loading-text' },
                    { text: "> ANALYZING DEPTH...", delay: 700, class: 'loading-text' },
                    { text: "> CALIBRATING FEELINGS INTENSITY...", delay: 900, class: 'loading-text' },
                    { text: "", delay: 1200 },
                    { text: "‚ö° ‚ö° ‚ö° EXTRA HARD MODE ACTIVATED ‚ö° ‚ö° ‚ö°", delay: 1500, class: 'error-text title-text' },
                    { text: "", delay: 2000 },
                    { text: "Press ENTER to proceed at your own risk...", delay: 2200, class: 'loading-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'deepFeelings'
            },
            
            deepFeelings: {
                lines: [
                    { text: "> LOADING EMOTIONAL CORE...", delay: 500, class: 'loading-text' },
                    { text: "", delay: 800 },
                    { text: ".... and write poems for you and wonder why you don't believe me", delay: 100 },
                    { text: "and have a feeling so deep I can't find words for it", delay: 100, class: 'title-text' },
                    { text: "and want to buy you a kitten I'd get jealous of", delay: 100 },
                    { text: "because it would get more attention than me", delay: 100 },
                    { text: "and keep you in bed when you have to go", delay: 100, class: 'title-text' },
                    { text: "and cry like a baby when you finally do", delay: 100 },
                    { text: "and get rid of the roaches and buy you presents you don't want", delay: 100, class: 'title-text' },
                    { text: "and take them away again and ask you to marry me", delay: 100 },
                    { text: "and you say no again but keep on asking", delay: 100 },
                    { text: "because though you think I don't mean it I do always have", delay: 100 },
                    { text: "from the first time I asked you", delay: 100 },
                    { text: "and wander the city thinking it's empty without you", delay: 100, class: 'title-text' },
                    { text: "and want want you want and think I'm losing myself", delay: 100 },
                    { text: "but know I'm safe with you", delay: 100 },
                    { text: "and tell you the worst of me", delay: 100, class: 'title-text' },
                    { text: "and try to give you the best of me", delay: 100, class: 'title-text' },
                    { text: "because you don't deserve any less", delay: 100, class: 'title-text' },
                    { text: "and answer your questions when I'd rather not", delay: 100 },
                    { text: "and tell you the truth when I really don't want to", delay: 100 },
                    { text: "and try to be honest because I know you prefer it", delay: 100 },
                    { text: "and think it's all over but hang on in for just ten more minutes", delay: 100, class: 'title-text' },
                    { text: "before you throw me out of your life and forget who I am", delay: 100 },
                    { text: "and try to get closer to you", delay: 100, class: 'title-text' },
                    { text: "because it's a beautiful learning to know you", delay: 100, class: 'title-text' },
                    { text: "and well worth the effort", delay: 100, class: 'title-text' },
                    { text: "and speak German to you badly and Hebrew to you worse", delay: 100 },
                    { text: "and make love with you at three in the morning", delay: 100 },
                    { text: "and somehow somehow somehow communicate", delay: 100 },
                    { text: "some of the overwhelming undying overpowering", delay: 100 },
                    { text: "unconditional all-encompassing heart-enriching", delay: 100 },
                    { text: "mind-expanding on-going never-ending", delay: 100 },
                    { text: "love I have for you.", delay: 100 },
                    { text: "", delay: 2000 },
                    { text: "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó", delay: 200, class: 'error-text' },
                    { text: "‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë", delay: 200, class: 'error-text' },
                    { text: "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë", delay: 200, class: 'error-text' },
                    { text: "‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë", delay: 200, class: 'error-text' },
                    { text: "‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë", delay: 200, class: 'error-text' },
                    { text: "‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù", delay: 200, class: 'error-text' },
                    { text: "", delay: 1000 },
                    { text: "THE END", delay: 1000, class: 'title-text' }
                ],
                inputPrompt: undefined
            }
        };
        
        function clearTerminal() {
            document.getElementById('terminalContent').innerHTML = '';
        }
        
        function addLine(text, className = '') {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            line.textContent = text;
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
        }
        
        function addImage(imageSrc, className = '') {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            const img = document.createElement('img');
            img.src = imageSrc;
            img.alt = 'Waitress';
            line.appendChild(img);
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
        }
        
        function addFireworksCanvas() {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = 'terminal-line fireworks-canvas';
            
            const canvas = document.createElement('canvas');
            canvas.width = 240;
            canvas.height = 80;
            canvas.id = 'fireworksCanvas';
            
            line.appendChild(canvas);
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
            
            startFireworks(canvas);
        }
        
        function startFireworks(canvas) {
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            const particles = [];
            let animationId;
            
            class Particle {
                constructor(x, y, vx, vy, color, life = 60, trail = true) {
                    this.x = Math.floor(x);
                    this.y = Math.floor(y);
                    this.vx = vx;
                    this.vy = vy;
                    this.color = color;
                    this.life = life;
                    this.maxLife = life;
                    this.gravity = 0.08;
                    this.friction = 0.96;
                    this.trail = trail;
                    this.size = 2;
                }
                
                update() {
                    this.vx *= this.friction;
                    this.vy *= this.friction;
                    this.vy += this.gravity;
                    
                    this.x = Math.floor(this.x + this.vx);
                    this.y = Math.floor(this.y + this.vy);
                    
                    this.life--;
                }
                
                draw() {
                    const alpha = this.life / this.maxLife;
                    ctx.save();
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.size, this.size);
                    ctx.restore();
                }
                
                isDead() {
                    return this.life <= 0;
                }
            }
            
            function createFirework(x, y) {
                const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff0080', '#8000ff', '#00ff40'];
                const particleCount = 8;
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const velocity = 1.5 + Math.random() * 0.5;
                    const vx = Math.cos(angle) * velocity;
                    const vy = Math.sin(angle) * velocity;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    particles.push(new Particle(x, y, vx, vy, color, 50 + Math.random() * 15));
                }
            }
            
            function createSparkles(x, y) {
                const sparkleColors = ['#ffffff', '#00ffff', '#ffff00'];
                for (let i = 0; i < 3; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 1 + 0.3;
                    const vx = Math.cos(angle) * velocity;
                    const vy = Math.sin(angle) * velocity;
                    const color = sparkleColors[Math.floor(Math.random() * sparkleColors.length)];
                    
                    particles.push(new Particle(x, y, vx, vy, color, 25 + Math.random() * 10));
                }
            }
            
            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                for (let i = particles.length - 1; i >= 0; i--) {
                    const particle = particles[i];
                    particle.update();
                    particle.draw();
                    
                    if (particle.isDead()) {
                        particles.splice(i, 1);
                    }
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            // Start the animation
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            animate();
            
            // Create fireworks in cycles
            let fireworkCount = 0;
            let cycleCount = 0;
            const maxFireworks = 3;
            const maxCycles = 3;
            
            function startFireworkCycle() {
                fireworkCount = 0;
                
                const fireworkInterval = setInterval(() => {
                    if (fireworkCount < maxFireworks) {
                        const x = Math.random() * (canvas.width - 40) + 20;
                        const y = Math.random() * (canvas.height - 30) + 15;
                        createFirework(x, y);
                        
                        setTimeout(() => {
                            createSparkles(x + Math.random() * 10 - 5, y + Math.random() * 10 - 5);
                        }, 150);
                        
                        fireworkCount++;
                    } else {
                        clearInterval(fireworkInterval);
                        cycleCount++;
                        
                        if (cycleCount < maxCycles) {
                            setTimeout(() => {
                                startFireworkCycle();
                            }, 800);
                        } else {
                            setTimeout(() => {
                                cancelAnimationFrame(animationId);
                            }, 1200);
                        }
                    }
                }, 250);
            }
            
            startFireworkCycle();
        }
        
        function typeText(text, className = '', speed = 50) {
            return new Promise(resolve => {
                const terminalContent = document.getElementById('terminalContent');
                const terminal = document.getElementById('terminal');
                const line = document.createElement('div');
                line.className = `terminal-line ${className}`;
                terminalContent.appendChild(line);
                
                let i = 0;
                const typeInterval = setInterval(() => {
                    line.textContent = text.slice(0, i + 1);
                    terminal.scrollTop = terminal.scrollHeight;
                    i++;
                    
                    if (i >= text.length) {
                        clearInterval(typeInterval);
                        resolve();
                    }
                }, speed);
            });
        }
        
        function createInput(prompt = "> ") {
            const terminalContent = document.getElementById('terminalContent');
            const terminal = document.getElementById('terminal');
            const inputLine = document.createElement('div');
            inputLine.className = 'input-line';
            
            const promptSpan = document.createElement('span');
            promptSpan.className = 'prompt';
            promptSpan.textContent = prompt;
            
            const input = document.createElement('input');
            input.className = 'input-field';
            input.type = 'text';
            input.autocomplete = 'off';
            
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            
            inputLine.appendChild(promptSpan);
            inputLine.appendChild(input);
            inputLine.appendChild(cursor);
            
            terminalContent.appendChild(inputLine);
            terminal.scrollTop = terminal.scrollHeight;
            
            input.focus();
            inputEnabled = true;
            
            return input;
        }
        
        async function playScene(sceneName) {
            console.log('playScene called with:', sceneName);
            if (!gameScenes[sceneName]) {
                console.log('Scene not found:', sceneName);
                return;
            }
            
            const scene = gameScenes[sceneName];
            console.log('Playing scene:', sceneName, scene);
            isTyping = true;
            inputEnabled = false;
            
            
            // Type out all lines with delays
            for (const line of scene.lines) {
                await new Promise(resolve => setTimeout(resolve, line.delay));
                if (line.image) {
                    addImage(line.image, line.class || '');
                } else if (line.canvas) {
                    addFireworksCanvas();
                } else if (line.text === '') {
                    addLine('');
                } else {
                    await typeText(line.text, line.class || '');
                }
            }
            
            isTyping = false;
            
            // Create input if needed
            if (scene.inputPrompt !== undefined) {
                const input = createInput(scene.inputPrompt);
                
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && inputEnabled) {
                        handleInput(input.value.toLowerCase().trim(), scene);
                    }
                });
            }
            // If no input is defined, this is the end of the game
            else {
                console.log('End of game reached');
            }
        }
        
        function handleInput(userInput, scene) {
            console.log('handleInput called with:', userInput, 'scene:', currentScene, scene);
            inputEnabled = false;
            
            // Handle password scene
            if (currentScene === 'password') {
                if (userInput === scene.expectedInput.toLowerCase()) {
                    currentScene = scene.nextScene;
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    setTimeout(() => {
                        addLine(scene.errorMessage, 'error-text');
                        setTimeout(() => {
                            const input = createInput(scene.inputPrompt);
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && inputEnabled) {
                                    handleInput(input.value.toLowerCase().trim(), scene);
                                }
                            });
                        }, 1500);
                    }, 500);
                }
                return;
            }
            
            // Handle choice scenes
            if (Array.isArray(scene.expectedInput)) {
                if (scene.expectedInput.includes(userInput)) {
                    currentScene = scene.nextScene[userInput];
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    setTimeout(() => {
                        addLine("Invalid choice. Type A or B.", 'error-text');
                        setTimeout(() => {
                            const input = createInput(scene.inputPrompt);
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && inputEnabled) {
                                    handleInput(input.value.toLowerCase().trim(), scene);
                                }
                            });
                        }, 1000);
                    }, 500);
                }
                return;
            }
            
            // Handle single input scenes (welcome, advisor, etc.)
            if (scene.expectedInput === "") {
                console.log('Single input scene detected, nextScene:', scene.nextScene);
                currentScene = scene.nextScene;
                console.log('Transitioning to:', currentScene);
                setTimeout(() => playScene(currentScene), 500);
                return;
            }
            
            // Handle specific inputs (restart, back)
            if (userInput === scene.expectedInput) {
                if (scene.expectedInput === 'r') {
                    clearTerminal();
                    currentScene = 'password';
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    currentScene = scene.nextScene;
                    setTimeout(() => playScene(currentScene), 500);
                }
            } else {
                setTimeout(() => {
                    addLine(`Type "${scene.expectedInput.toUpperCase()}" to continue.`, 'error-text');
                    setTimeout(() => {
                        const input = createInput("");
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter' && inputEnabled) {
                                handleInput(input.value.toLowerCase().trim(), scene);
                            }
                        });
                    }, 1000);
                }, 500);
            }
        }
        
        // Start the game
        setTimeout(() => {
            playScene('password');
        }, 1000);
        
        // Prevent form submission and other unwanted behaviors
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                location.reload();
            }
        });
    </script>
</body>
</html>