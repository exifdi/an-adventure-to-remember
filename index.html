<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An adventure to remember</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #666666;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            line-height: 1.2;
            overflow-x: hidden;
            height: 100vh;
            letter-spacing: -0.5px;
        }
        
        /* Subtle scanlines */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%, 
                rgba(255, 255, 255, 0.01) 50%
            );
            background-size: 100% 1px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .terminal {
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        .terminal-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: 100%;
        }
        
        .terminal-line {
            margin: 2px 0;
            min-height: 16px;
        }
        
        .loading-text {
            color: #888888;
        }
        
        .error-text {
            color: #aa4444;
            animation: pulse 1s infinite;
        }
        
        .title-text {
            color: #999999;
            font-weight: 700;
            text-shadow: 0 0 5px rgba(153, 153, 153, 0.3);
        }
        
        .input-line {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .prompt {
            color: #666666;
            margin-right: 3px;
        }
        
        .input-field {
            background: transparent;
            border: none;
            color: #888888;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            outline: none;
            flex: 1;
            caret-color: #666666;
            letter-spacing: -0.5px;
        }
        
        .cursor {
            display: inline-block;
            background-color: #444444;
            width: 8px;
            height: 16px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .ascii-art {
            color: #777777;
            text-align: left;
            font-size: 11px;
            line-height: 1;
            text-shadow: 0 0 3px rgba(119, 119, 119, 0.2);
        }
        
        .fireworks-art {
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }
        
        .fireworks-effect {
            color: #ffaa00;
            animation: fireworks 0.8s infinite;
        }
        
        @keyframes fireworks {
            0% { opacity: 1; color: #ffaa00; }
            25% { opacity: 0.8; color: #ff6600; }
            50% { opacity: 0.6; color: #ff0066; }
            75% { opacity: 0.8; color: #6600ff; }
            100% { opacity: 1; color: #00aaff; }
        }
        
        .pixel-art {
            font-size: 10px;
            line-height: 0.8;
            color: #aaaaaa;
            font-family: monospace;
        }
        
        .link-green { color: #228B22; }
        .link-yellow { color: #FFD700; }
        .link-skin { color: #FDBCB4; }
        .hair-brown { color: #8B4513; }
        .hair-blonde { color: #DAA520; }
        
        .sword-art {
            color: #C0C0C0;
            text-shadow: 0 0 2px rgba(192, 192, 192, 0.5);
        }
        
        .neon-blue {
            animation: neonFlash 1.5s ease-in-out infinite;
        }
        
        @keyframes neonFlash {
            0%, 100% {
                color: #00BFFF;
                text-shadow: 
                    0 0 5px #00BFFF,
                    0 0 10px #00BFFF,
                    0 0 15px #00BFFF,
                    0 0 20px #00BFFF;
            }
            50% {
                color: #FF00FF;
                text-shadow: 
                    0 0 5px #FF00FF,
                    0 0 10px #FF00FF,
                    0 0 15px #FF00FF,
                    0 0 20px #FF00FF;
            }
        }
        
        .neon-red {
            animation: neonFlashRed 1.5s ease-in-out infinite;
        }
        
        @keyframes neonFlashRed {
            0%, 100% {
                color: #FF0000;
                text-shadow: 
                    0 0 5px #FF0000,
                    0 0 10px #FF0000,
                    0 0 15px #FF0000,
                    0 0 20px #FF0000;
            }
            50% {
                color: #FF6600;
                text-shadow: 
                    0 0 5px #FF6600,
                    0 0 10px #FF6600,
                    0 0 15px #FF6600,
                    0 0 20px #FF6600;
            }
        }
        
        .glitch-text {
            animation: glitch 0.5s infinite;
            color: #555555;
        }
        
        .clickable-question {
            color: #00ffff;
            cursor: pointer;
            display: inline-block;
            animation: pulse-glow 2s infinite;
            text-shadow: 0 0 10px #00ffff;
        }
        
        .clickable-question:hover {
            color: #ff00ff;
            text-shadow: 0 0 15px #ff00ff;
            transform: scale(1.2);
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .ending-button {
            color: #888888;
            cursor: pointer;
            display: inline;
            transition: all 0.3s ease;
            text-decoration: underline;
        }
        
        .ending-button:hover {
            color: #aaaaaa;
        }
        
        .attribution {
            color: #555555;
            font-size: 12px;
            font-weight: 300;
            opacity: 0.6;
            position: absolute;
            left: 0;
            top: -15px;
        }
        
        .poem-line-with-attribution {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            10% { transform: translate(-1px, -1px); }
            20% { transform: translate(1px, 1px); }
            30% { transform: translate(-1px, 1px); }
            40% { transform: translate(1px, -1px); }
            50% { transform: translate(-1px, -1px); }
            60% { transform: translate(1px, 1px); }
            70% { transform: translate(-1px, 1px); }
            80% { transform: translate(1px, -1px); }
            90% { transform: translate(-1px, -1px); }
            100% { transform: translate(0); }
        }
        
        .hidden {
            display: none;
        }
        
        .waitress-image {
            text-align: left;
            margin: 5px 0;
        }
        
        .waitress-image img {
            max-width: 200px;
            max-height: 200px;
            filter: sepia(100%) hue-rotate(180deg) brightness(0.8);
            opacity: 0.8;
        }
        
        .fireworks-canvas {
            text-align: left;
            margin: 5px 0;
            padding-left: 20px;
        }
        
        .fireworks-canvas canvas {
            background: transparent;
            max-width: 100%;
            height: auto;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body>
    <div class="terminal" id="terminal">
        <div class="terminal-content" id="terminalContent">
            <div class="terminal-line">&gt; INITIALIZING MEMORY DRIVE...</div>
        </div>
    </div>
    
    <!-- Audio element for Vivaldi Summer -->
    <audio id="vivaldiAudio" preload="auto">
        <source src="vivaldi-summer.mp3" type="audio/mpeg">
        <source src="vivaldi-summer.ogg" type="audio/ogg">
        <!-- Fallback: You can use a CDN link to a public domain recording -->
        <source src="https://www.soundjay.com/misc/sounds/classical-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        let currentScene = 'password';
        let gameState = {};
        let isTyping = false;
        let inputEnabled = false;
        
        // Game data structure
        const gameScenes = {
            password: {
                lines: [
                    { text: "> LOADING PERSONAL FILES...", delay: 300, class: 'loading-text' },
                    { text: "> SCANNING FOR AUTHORIZATION...", delay: 600, class: 'loading-text' },
                    { text: "", delay: 400 },
                    { text: "ENTER ACCESS CODE:", delay: 200, class: 'title-text' },
                    { text: "[Hint: Your favorite design movement]", delay: 150 },
                    { text: "", delay: 20 }
                ],
                inputPrompt: "INPUT: ",
                expectedInput: "bauhaus",
                errorMessage: "ACCESS DENIED - TRY AGAIN",
                nextScene: 'welcome'
            },
            
            welcome: {
                lines: [
                    { text: "> ACCESS GRANTED", delay: 20, class: 'loading-text' },
                    { text: "> LOADING USER PROFILE...", delay: 40, class: 'loading-text' },
                    { text: "> IDENTITY CONFIRMED", delay: 60, class: 'loading-text' },
                    { text: "", delay: 100 },
                    { text: "WELCOME NICKI, YOU ARE THE MAIN CHARACTER ⚔️", delay: 100, class: 'title-text' },
                    { text: "", delay: 1400 },
                    { text: "Press ENTER to begin...", delay: 100 }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'july17'
            },
            
            july17: {
                lines: [
                    { text: "> LOADING DATE...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 400 },
                    { text: "IT'S JULY 17TH 2025", delay: 600, class: 'title-text' },
                    { text: "YOU NEED TO WORK THE NEXT DAY, BUT YOU'VE MADE PLANS TO MEET WITH D FROM TWITTER", delay: 200 },
                    { text: "YOU ARE NOT FEELING IT 100%, CONSIDERING WHETHER YOU SHOULD CANCEL", delay: 200 },
                    { text: "", delay: 100 },
                    { text: "THE ETERNAL QUESTION PRESENTS ITSELF:", delay: 100 },
                    { text: "", delay: 100 },
                    { text: "A) GO MEET HER AS PLANNED", delay: 100 },
                    { text: "B) CANCEL, STAY IN CAUSE LET'S FACE IT, YOU'LL HAVE MORE FUN BY YOURSELF", delay: 100 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'firstBar', b: 'gameOver' }
            },
            
            gameOver: {
                lines: [
                    { text: "> PROCESSING CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> CALCULATING TIMELINE ALTERATIONS...", delay: 100, class: 'loading-text' },
                    { text: "", delay: 100 },
                    { text: "CONGRATULATIONS!", delay: 100, class: 'error-text' },
                    { text: "YOU JUST MISSED THE TIME OF YOUR LIFE", delay: 100, class: 'error-text' },
                    { text: "", delay: 1200 },
                    { text: "┌─────────────────┐", delay: 100 },
                    { text: "│      ಠ_ಠ LOSER     │", delay: 100 },
                    { text: "└─────────────────┘", delay: 100 },
                    { text: "", delay: 1900 },
                    { text: "GAME OVER", delay: 2100, class: 'error-text' },
                    { text: "", delay: 2300 },
                    { text: "Type R to restart...", delay: 100 }
                ],
                inputPrompt: "",
                expectedInput: "r",
                nextScene: 'july17'
            },
            
            firstBar: {
                lines: [
                    { text: "> PROCESSING CHOICE A...", delay: 200, class: 'loading-text' },
                    { text: "> EXCELLENT DECISION DETECTED", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "GREAT CHOICE!", delay: 800, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "YOU MEET AT THE DESIGNATED SPOT", delay: 200 },
                    { text: "AT FIRST, YOU FIND THAT SHE LOOKS... DIFFERENT", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "BUT AS YOU HEAD TO THE BAR AND START DRINKING", delay: 200 },
                    { text: "THE CONVERSATION BEGINS TO FLOW EFFORTLESSLY", delay: 200 },
                    { text: "YOU DISCOVER SHE'S NOT ONLY BEAUTIFUL BUT ALSO INTERESTING", delay: 200 },
                    { text: "", delay: 600 },
                    { text: "BUT UH-OH... THE BAR IS CLOSING", delay: 200 },
                    { text: "SHE DOESN'T SEEM TO WANT THE NIGHT TO END", delay: 200 },
                    { text: "", delay: 800 },
                    { text: "WHAT ABOUT YOU?", delay: 200, class: 'title-text' },
                    { text: "", delay: 600 },
                    { text: "A) SUGGEST MOVING TO THE BAR NEXT DOOR", delay: 220 },
                    { text: "B) CALL IT A NIGHT AND HEAD HOME - YOU DO WORK TOMORROW AFTER ALL", delay: 240 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'secondBar', b: 'gameOver' }
            },
            
            secondBar: {
                lines: [
                    { text: "> PROCESSING ADVENTUROUS CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING BEERS 🍻🍻 ...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "THE CONVERSATION KEEPS FLOWING", delay: 200 },
                    { text: "BUT HONESTLY, YOU'RE NOT EVEN SURE WHAT ABOUT ANYMORE", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "AT SOME POINT, YOU LOOK AROUND...", delay: 300 },
                    { text: "YOU'RE THE LAST PEOPLE IN THE BAR", delay: 200 },
                    { text: "YOU'RE DEFINITELY HOLDING UP CLOSING TIME FOR THE STAFF", delay: 200 },
                    { text: "SHE NOTICES TOO", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "TIME FOR ANOTHER BAR CHANGE?", delay: 200, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "A) ABSOLUTELY, LET'S GO", delay: 100 },
                    { text: "B) MAYBE THE DRINKING IS GETTING OUT OF HAND? TIME TO CALL IT", delay: 100 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'ethicalDilemma', b: 'gameOver' }
            },
            
            ethicalDilemma: {
                lines: [
                    { text: "> PROCESSING BOLD CHOICE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING ETHICAL DILEMMA...", delay: 200, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "AT RESI", delay: 200, class: 'neon-blue' },
                    { text: "", delay: 400 },
                    { text: "AND THE 🍻🍻 KEEP COMING", delay: 200 },
                    { text: "AND THIS TIME THE CONVERSATION IS GETTING SPICY", delay: 200 },
                    { text: "SOMEHOW THE TOPIC SHIFTS TO RELATIONSHIPS", delay: 200 },
                    { text: "CHEATING. CHEATERS.", delay: 250 },
                    { text: "", delay: 300 },
                    { text: "SHE HAS A GIRLFRIEND", delay: 200 },
                    { text: "BUT SAYS SHE'S KIND OF A CHEATER...", delay: 350 },
                    { text: "", delay: 400 },
                    { text: "WAIT... IS SHE HITTING ON YOU?", delay: 400 },
                    { text: "THE ALCOHOL HAS CLEARLY CLOUDED YOUR ABILITY TO THINK STRAIGHT", delay: 200 },
                    { text: "BUT THE SIGNALS SEEM PRETTY CLEAR", delay: 200 },
                    { text: "", delay: 450 },
                    { text: "SHE EXCUSES HERSELF TO THE BATHROOM", delay: 200 },
                    { text: "LEAVING YOU ALONE WITH YOUR THOUGHTS", delay: 200 },
                    { text: "", delay: 600 },
                    { text: "YOU LIKE HER. YOU'RE TEMPTED TO MAKE A MOVE.", delay: 200, class: 'title-text'},
                    { text: "BUT THIS IS A HARD ETHICAL DECISION", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "YOU CAN SEEK GUIDANCE FROM A WISE ADVISOR:", delay: 200 },
                    { text: "THE GIRL THAT WORKS HERE. ASK HER?", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "A) YES - SEEK WISDOM", delay: 250 },
                    { text: "B) NO - FIGURE THIS OUT YOURSELF", delay: 200 },
                    { text: "", delay: 100 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'advisor', b: 'indecisive' }
            },
            
            advisor: {
                lines: [
                    { text: "> PROCESSING WISDOM SEEKING...", delay: 500, class: 'loading-text' },
                    { text: "> LOADING ADVISOR RESPONSE...", delay: 500, class: 'loading-text' },
                    { text: "", delay: 1500 },
                    { image: "d27e787009a7223.png", delay: 800, class: 'waitress-image' },
                    { text: "", delay: 400 },
                    { text: "SHE SAYS IT'S OK TO MAKE A MOVE IF THINGS ARE PURELY PHYSICAL", delay: 500 },
                    { text: "THAT'S ALL THE VALIDATION YOU NEED", delay: 500 },
                    { text: "", delay: 300 },
                    { text: "TIME FOR A 4TH BAR?", delay: 200 },
                    { text: "", delay: 400 },
                    { text: "Press ENTER to go to BERLIN...", delay: 500, class: 'title-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'berlin'
            },
            
            indecisive: {
                lines: [
                    { text: "> PROCESSING INDECISION...", delay: 200, class: 'loading-text' },
                    { text: "> ERROR: SELF-RELIANCE FAILURE", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "😵‍💫", delay: 800, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "YOU CANNOT BE TRUSTED TO MAKE YOUR OWN DECISIONS", delay: 1000, class: 'error-text' },
                    { text: "", delay: 600 },
                    { text: "GO BACK AND ASK THE GIRL", delay: 800, class: 'title-text' },
                    { text: "", delay: 400 },
                    { text: "Type A to go back and ask...", delay: 600 }
                ],
                inputPrompt: "",
                expectedInput: "a",
                nextScene: 'advisor'
            },
            
            berlin: {
                lines: [
                    { text: "> LOADING LOCATION: BERLIN...", delay: 200, class: 'loading-text' },
                    { text: "> ATMOSPHERIC TENSION: MAXIMUM", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "BERLIN", delay: 200, class: 'neon-red' },
                    { text: "", delay: 600 },
                    { text: "THE FOURTH BAR. THE ATMOSPHERE IS ELECTRIC.", delay: 400 },
                    { text: "THE SPACE BETWEEN YOU SEEMS TO SHRINK", delay: 400 },
                    { text: "", delay: 600 },
                    { text: "YOU TELL HER YOU WANT TO KISS HER", delay: 800 },
                    { text: "", delay: 1000 },
                    { text: "SHE'S FLUSTERED", delay: 600 },
                    { text: "SHE HAS BEEN WAITING FOR IT", delay: 600 },
                    { text: "SHE TELLS YOU SHE WANTS YOU TO KISS HER", delay: 800 },
                    { text: "", delay: 400 },
                    { text: "THE MOMENT HANGS IN THE AIR", delay: 400 },
                    { text: "EVERYTHING ELSE FADES AWAY", delay: 400 },
                    { text: "", delay: 600 },
                    { text: "A) CLOSE THE DISTANCE - KISS HER NOW", delay: 400 },
                    { text: "B) REALITY CHECK - MAKE A JOKE AND STEP BACK", delay: 400 },
                    { text: "", delay: 400 }
                ],
                inputPrompt: "CHOICE: ",
                expectedInput: ["a", "b"],
                nextScene: { a: 'fireworks', b: 'crash' }
            },
            
            crash: {
                lines: [
                    { text: "> SYSTEM ERROR...", delay: 200, class: 'glitch-text loading-text' },
                    { text: "> LOGIC FAILURE DETECTED...", delay: 400, class: 'glitch-text loading-text' },
                    { text: "", delay: 800 },
                    { text: "ARE YOU DUMB????", delay: 120, class: 'glitch-text error-text' },
                    { text: "", delay: 1600 },
                    { text: "╔════════════════════╗", delay: 200, class: 'glitch-text' },
                    { text: "║ XXXXX ERROR XXXXXX ║", delay: 200, class: 'glitch-text' },
                    { text: "╚════════════════════╝", delay: 200, class: 'glitch-text' },
                    { text: "", delay: 200 },
                    { text: "Type B to go BACK...", delay: 300, class: 'error-text' }
                ],
                inputPrompt: "",
                expectedInput: "b",
                nextScene: 'berlin'
            },
            
            fireworks: {
                lines: [
                    { text: "> PROCESSING KISSING INITIATIVE...", delay: 200, class: 'loading-text' },
                    { text: "> LOADING FIREWORKS PROTOCOL...", delay: 400, class: 'loading-text' },
                    { text: "", delay: 600 },
                    { text: "* * * * FIREWORKS * * * *", delay: 400, class: 'title-text fireworks-effect' },
                    { canvas: true, delay: 1000 },
                    { text: "", delay: 4500 },
                    { text: "       (◡ ‿ ◡)💋(◡ ‿ ◡)", delay: 400, class: 'ascii-art' },
                    { text: "", delay: 300 },
                    { text: "Press ENTER to continue to finale...", delay: 500, class: 'title-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'finale'
            },
            
            finale: {
                lines: [
                    { text: "> PROCESSING EMOTIONAL DATA...", delay: 500, class: 'loading-text' },
                    { text: "> ANALYZING DEPTH...", delay: 700, class: 'loading-text' },
                    { text: "> CALIBRATING FEELINGS INTENSITY...", delay: 900, class: 'loading-text' },
                    { text: "", delay: 1200 },
                    { text: "⚡ ⚡ ⚡ EXTRA HARD MODE ACTIVATED ⚡ ⚡ ⚡", delay: 1500, class: 'error-text title-text' },
                    { text: "", delay: 2000 },
                    { text: "Press ENTER to proceed at your own risk...", delay: 2200, class: 'loading-text' }
                ],
                inputPrompt: "",
                expectedInput: "",
                nextScene: 'deepFeelings'
            },
            
            deepFeelings: {
                lines: [
                    { text: "> LOADING EMOTIONAL CORE...", delay: 500, class: 'loading-text' },
                    { text: "", delay: 800 },
                    { text: ".... and write poems for you and wonder why you don't believe me", delay: 100, attribution: "Crave, Sarah Kane" },
                    { text: "and have a feeling so deep I can't find words for it", delay: 100, class: 'title-text' },
                    { text: "and want to buy you a kitten I'd get jealous of", delay: 100 },
                    { text: "because it would get more attention than me", delay: 100 },
                    { text: "and keep you in bed when you have to go", delay: 100, class: 'title-text' },
                    { text: "and cry like a baby when you finally do", delay: 100 },
                    { text: "and get rid of the roaches and buy you presents you don't want", delay: 100, class: 'title-text' },
                    { text: "and take them away again and ask you to marry me", delay: 100 },
                    { text: "and you say no again but keep on asking", delay: 100 },
                    { text: "because though you think I don't mean it I do always have", delay: 100 },
                    { text: "from the first time I asked you", delay: 100 },
                    { text: "and wander the city thinking it's empty without you", delay: 100, class: 'title-text' },
                    { text: "and want want you want and think I'm losing myself", delay: 100 },
                    { text: "but know I'm safe with you", delay: 100 },
                    { text: "and tell you the worst of me", delay: 100, class: 'title-text' },
                    { text: "and try to give you the best of me", delay: 100, class: 'title-text' },
                    { text: "because you don't deserve any less", delay: 100, class: 'title-text' },
                    { text: "and answer your questions when I'd rather not", delay: 100 },
                    { text: "and tell you the truth when I really don't want to", delay: 100 },
                    { text: "and try to be honest because I know you prefer it", delay: 100 },
                    { text: "and think it's all over but hang on in for just ten more minutes", delay: 100, class: 'title-text' },
                    { text: "before you throw me out of your life and forget who I am", delay: 100 },
                    { text: "and try to get closer to you", delay: 100, class: 'title-text' },
                    { text: "because it's a beautiful learning to know you", delay: 100, class: 'title-text' },
                    { text: "and well worth the effort", delay: 100, class: 'title-text' },
                    { text: "and speak German to you badly and Hebrew to you worse", delay: 100 },
                    { text: "and make love with you at three in the morning", delay: 100 },
                    { text: "and somehow somehow somehow communicate", delay: 100 },
                    { text: "some of the overwhelming undying overpowering", delay: 100 },
                    { text: "unconditional all-encompassing heart-enriching", delay: 100 },
                    { text: "mind-expanding on-going never-ending", delay: 100 },
                    { text: "love I have for you.", delay: 100 },
                    { text: "", delay: 2000 },
                    { text: "THE END", delay: 1000, class: 'title-text' },
                    { text: "(?)", delay: 100, class: 'clickable-question', id: 'question-mark' },
                ],
                inputPrompt: undefined
            }
        };
        
        function clearTerminal() {
            document.getElementById('terminalContent').innerHTML = '';
        }
        
        function addLine(text, className = '', id = '') {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            if (id) line.id = id;
            line.textContent = text;
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
            return line;
        }
        
        function addImage(imageSrc, className = '') {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = `terminal-line ${className}`;
            const img = document.createElement('img');
            img.src = imageSrc;
            img.alt = 'Waitress';
            line.appendChild(img);
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
        }
        
        function addFireworksCanvas() {
            const terminalContent = document.getElementById('terminalContent');
            const line = document.createElement('div');
            line.className = 'terminal-line fireworks-canvas';
            
            const canvas = document.createElement('canvas');
            canvas.width = 240;
            canvas.height = 80;
            canvas.id = 'fireworksCanvas';
            
            line.appendChild(canvas);
            terminalContent.appendChild(line);
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
            
            startFireworks(canvas);
        }
        
        function startFireworks(canvas) {
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;
            const particles = [];
            let animationId;
            
            class Particle {
                constructor(x, y, vx, vy, color, life = 60, trail = true) {
                    this.x = Math.floor(x);
                    this.y = Math.floor(y);
                    this.vx = vx;
                    this.vy = vy;
                    this.color = color;
                    this.life = life;
                    this.maxLife = life;
                    this.gravity = 0.08;
                    this.friction = 0.96;
                    this.trail = trail;
                    this.size = 2;
                }
                
                update() {
                    this.vx *= this.friction;
                    this.vy *= this.friction;
                    this.vy += this.gravity;
                    
                    this.x = Math.floor(this.x + this.vx);
                    this.y = Math.floor(this.y + this.vy);
                    
                    this.life--;
                }
                
                draw() {
                    const alpha = this.life / this.maxLife;
                    ctx.save();
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.size, this.size);
                    ctx.restore();
                }
                
                isDead() {
                    return this.life <= 0;
                }
            }
            
            function createFirework(x, y) {
                const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff0080', '#8000ff', '#00ff40'];
                const particleCount = 8;
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const velocity = 1.5 + Math.random() * 0.5;
                    const vx = Math.cos(angle) * velocity;
                    const vy = Math.sin(angle) * velocity;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    particles.push(new Particle(x, y, vx, vy, color, 50 + Math.random() * 15));
                }
            }
            
            function createSparkles(x, y) {
                const sparkleColors = ['#ffffff', '#00ffff', '#ffff00'];
                for (let i = 0; i < 3; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 1 + 0.3;
                    const vx = Math.cos(angle) * velocity;
                    const vy = Math.sin(angle) * velocity;
                    const color = sparkleColors[Math.floor(Math.random() * sparkleColors.length)];
                    
                    particles.push(new Particle(x, y, vx, vy, color, 25 + Math.random() * 10));
                }
            }
            
            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                for (let i = particles.length - 1; i >= 0; i--) {
                    const particle = particles[i];
                    particle.update();
                    particle.draw();
                    
                    if (particle.isDead()) {
                        particles.splice(i, 1);
                    }
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            // Start the animation
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            animate();
            
            // Create fireworks in cycles
            let fireworkCount = 0;
            let cycleCount = 0;
            const maxFireworks = 3;
            const maxCycles = 3;
            
            function startFireworkCycle() {
                fireworkCount = 0;
                
                const fireworkInterval = setInterval(() => {
                    if (fireworkCount < maxFireworks) {
                        const x = Math.random() * (canvas.width - 40) + 20;
                        const y = Math.random() * (canvas.height - 30) + 15;
                        createFirework(x, y);
                        
                        setTimeout(() => {
                            createSparkles(x + Math.random() * 10 - 5, y + Math.random() * 10 - 5);
                        }, 150);
                        
                        fireworkCount++;
                    } else {
                        clearInterval(fireworkInterval);
                        cycleCount++;
                        
                        if (cycleCount < maxCycles) {
                            setTimeout(() => {
                                startFireworkCycle();
                            }, 800);
                        } else {
                            setTimeout(() => {
                                cancelAnimationFrame(animationId);
                            }, 1200);
                        }
                    }
                }, 250);
            }
            
            startFireworkCycle();
        }
        
        function typeText(text, className = '', speed = 50, id = '', attribution = '') {
            return new Promise(resolve => {
                const terminalContent = document.getElementById('terminalContent');
                const terminal = document.getElementById('terminal');
                const line = document.createElement('div');
                line.className = `terminal-line ${className}`;
                if (id) line.id = id;
                
                if (attribution) {
                    line.className += ' poem-line-with-attribution';
                    const attributionSpan = document.createElement('span');
                    attributionSpan.className = 'attribution';
                    attributionSpan.textContent = attribution;
                    line.appendChild(attributionSpan);
                }
                
                terminalContent.appendChild(line);
                
                let i = 0;
                const typeInterval = setInterval(() => {
                    if (attribution) {
                        // For lines with attribution, need to update the text content while preserving the attribution span
                        line.childNodes.forEach(node => {
                            if (node.nodeType === Node.TEXT_NODE) {
                                node.textContent = text.slice(0, i + 1);
                            }
                        });
                        if (line.childNodes.length === 1) {
                            line.insertBefore(document.createTextNode(text.slice(0, i + 1)), line.firstChild);
                        }
                    } else {
                        line.textContent = text.slice(0, i + 1);
                    }
                    terminal.scrollTop = terminal.scrollHeight;
                    i++;
                    
                    if (i >= text.length) {
                        clearInterval(typeInterval);
                        resolve(line);
                    }
                }, speed);
            });
        }
        
        function createInput(prompt = "> ") {
            const terminalContent = document.getElementById('terminalContent');
            const terminal = document.getElementById('terminal');
            const inputLine = document.createElement('div');
            inputLine.className = 'input-line';
            
            const promptSpan = document.createElement('span');
            promptSpan.className = 'prompt';
            promptSpan.textContent = prompt;
            
            const input = document.createElement('input');
            input.className = 'input-field';
            input.type = 'text';
            input.autocomplete = 'off';
            
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            
            inputLine.appendChild(promptSpan);
            inputLine.appendChild(input);
            inputLine.appendChild(cursor);
            
            terminalContent.appendChild(inputLine);
            terminal.scrollTop = terminal.scrollHeight;
            
            input.focus();
            inputEnabled = true;
            
            return input;
        }
        
        async function playScene(sceneName) {
            console.log('playScene called with:', sceneName);
            if (!gameScenes[sceneName]) {
                console.log('Scene not found:', sceneName);
                return;
            }
            
            const scene = gameScenes[sceneName];
            console.log('Playing scene:', sceneName, scene);
            
            // Clear screen between scenes for classic adventure game feel
            clearTerminal();
            
            isTyping = true;
            inputEnabled = false;
            
            
            // Type out all lines with delays
            for (const line of scene.lines) {
                await new Promise(resolve => setTimeout(resolve, line.delay));
                if (line.image) {
                    addImage(line.image, line.class || '');
                } else if (line.canvas) {
                    addFireworksCanvas();
                } else if (line.text === '') {
                    addLine('');
                } else {
                    const element = await typeText(line.text, line.class || '', 50, line.id || '', line.attribution || '');
                    
                    // Add click handler for question mark
                    if (line.id === 'question-mark') {
                        element.style.cursor = 'pointer';
                        element.addEventListener('click', showAlternateEndings);
                    }
                }
            }
            
            isTyping = false;
            
            // Create input if needed
            if (scene.inputPrompt !== undefined) {
                const input = createInput(scene.inputPrompt);
                
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && inputEnabled) {
                        handleInput(input.value.toLowerCase().trim(), scene);
                    }
                });
            }
            // If no input is defined, this is the end of the game
            else {
                console.log('End of game reached');
            }
        }
        
        function handleInput(userInput, scene) {
            console.log('handleInput called with:', userInput, 'scene:', currentScene, scene);
            inputEnabled = false;
            
            // Handle password scene
            if (currentScene === 'password') {
                if (userInput === scene.expectedInput.toLowerCase()) {
                    currentScene = scene.nextScene;
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    setTimeout(() => {
                        addLine(scene.errorMessage, 'error-text');
                        setTimeout(() => {
                            const input = createInput(scene.inputPrompt);
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && inputEnabled) {
                                    handleInput(input.value.toLowerCase().trim(), scene);
                                }
                            });
                        }, 1500);
                    }, 500);
                }
                return;
            }
            
            // Handle choice scenes
            if (Array.isArray(scene.expectedInput)) {
                if (scene.expectedInput.includes(userInput)) {
                    currentScene = scene.nextScene[userInput];
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    setTimeout(() => {
                        addLine("Invalid choice. Type A or B.", 'error-text');
                        setTimeout(() => {
                            const input = createInput(scene.inputPrompt);
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter' && inputEnabled) {
                                    handleInput(input.value.toLowerCase().trim(), scene);
                                }
                            });
                        }, 1000);
                    }, 500);
                }
                return;
            }
            
            // Handle single input scenes (welcome, advisor, etc.)
            if (scene.expectedInput === "") {
                console.log('Single input scene detected, nextScene:', scene.nextScene);
                currentScene = scene.nextScene;
                console.log('Transitioning to:', currentScene);
                setTimeout(() => playScene(currentScene), 500);
                return;
            }
            
            // Handle specific inputs (restart, back)
            if (userInput === scene.expectedInput) {
                if (scene.expectedInput === 'r') {
                    clearTerminal();
                    currentScene = 'password';
                    setTimeout(() => playScene(currentScene), 500);
                } else {
                    currentScene = scene.nextScene;
                    setTimeout(() => playScene(currentScene), 500);
                }
            } else {
                setTimeout(() => {
                    addLine(`Type "${scene.expectedInput.toUpperCase()}" to continue.`, 'error-text');
                    setTimeout(() => {
                        const input = createInput("");
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter' && inputEnabled) {
                                handleInput(input.value.toLowerCase().trim(), scene);
                            }
                        });
                    }, 1000);
                }, 500);
            }
        }
        
        // Alternate ending content broken into lines
        const alternateEndingLines = [
            { text: "and we met and you're cute and you're funny and you're interesting", delay: 100 },
            { text: "and I'm infatuated and intrigued", delay: 100 },
            { text: "and you talk about things passionately and honestly", delay: 100 },
            { text: "and you're moved by the little things and you cry", delay: 100 },
            { text: "and I find this yperoxo and it makes me want to be part of it", delay: 100 },
            { text: "and I want to allow myself to dream of a future with you,", delay: 100 },
            { text: "and I want you to want me and to make me a central part of your story", delay: 100 },
            { text: "and I want to be vulnerable with you even if I regret it later", delay: 100 },
            { text: "when you'll use it against me, and try and fail and try again", delay: 100 },
            { text: "and suffer together", delay: 100 },
            { text: "and maybe embrace the darkness inside you 'cause I recognise it", delay: 100 },
            { text: "and feel strongly and deeply", delay: 100 },
            { text: "and dread the day that you will no longer find me interesting", delay: 100 },
            { text: "and I want to learn everything about the things you love", delay: 100 },
            { text: "and I want to teach you everything about the things I love", delay: 100 },
            { text: "and I want us to learn new things together", delay: 100 },
            { text: "and I want to sit next to you while you do things that you love (like playing ps)", delay: 100 },
            { text: "and watch how your face lights up", delay: 100 },
            { text: "and maybe stay in instead of going out", delay: 100 },
            { text: "or go out if you absolutely want to", delay: 100 },
            { text: "and grow along each other", delay: 100 },
            { text: "and have our own inside jokes and references", delay: 100 },
            { text: "and maybe miss each other some days", delay: 100 },
            { text: "'cause I sleep in the night and you sleep in the morning", delay: 100 },
            { text: "and I want to merge into you", delay: 100 },
            { text: "and find myself reflected in your eyes", delay: 100 },
            { text: "and build something beautiful together", delay: 100 },
            { text: "one ordinary extraordinary day at a time", delay: 100 }
        ];
        
        function showAlternateEndings() {
            // Disable the question mark
            const questionMark = document.querySelector('.clickable-question');
            if (questionMark) {
                questionMark.style.cursor = 'default';
                questionMark.style.color = '#666666';
                questionMark.style.textShadow = 'none';
                questionMark.style.animation = 'none';
                questionMark.removeEventListener('click', showAlternateEndings);
            }
            
            const terminalContent = document.getElementById('terminalContent');
            
            // Add empty line
            addLine('');
            
            // Add button as a simple terminal line
            const line = document.createElement('div');
            line.className = 'terminal-line';
            
            const button = document.createElement('span');
            button.className = 'ending-button';
            button.textContent = 'Something Original';
            button.addEventListener('click', showEnding);
            
            line.appendChild(button);
            terminalContent.appendChild(line);
            
            document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
        }
        
        async function showEnding() {
            // Clear the terminal for clean presentation
            clearTerminal();
            
            // Add some initial spacing
            addLine('');
            
            // Type out the alternate ending line by line
            for (const line of alternateEndingLines) {
                await new Promise(resolve => setTimeout(resolve, line.delay));
                await typeText(line.text, '');
            }
        }

        // Start the game
        setTimeout(() => {
            playScene('password');
        }, 1000);
        
        // Prevent form submission and other unwanted behaviors
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                location.reload();
            }
        });
    </script>
</body>
</html>